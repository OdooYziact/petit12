<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <template id="report_accountinvoice_table" inherit_id="sale.report_invoice_layouted">

        <!-- Modification du tableau principal -->
        <xpath expr="//t[@name='lines_layouted']/table/tbody/t/t[2]/tr/td[1]" position="replace">
            <td><span t-field="l.product_id.name"/></td>
        </xpath>

        <xpath expr="//t[@name='lines_layouted']/table/thead/tr" position="replace">
            <th>Référence</th>
            <th>Désignation</th>
            <th class="text-right">Quantité</th>
            <th class="text-right">Prix unitaire</th>
            <th t-if="display_discount" class="text-right" groups="sale.group_discount_per_so_line">Rem.(%)</th>
            <th class="text-right">TVA</th>
            <th class="text-right">Montant HT</th>
        </xpath>


        <xpath expr="//t[@name='lines_layouted']/table/tbody/t/t[2]/tr/td[1]" position="before">
            <td><span t-field="l.product_id.default_code"/></td>
        </xpath>

    </template>



    <template id="report_accountinvoice_document" inherit_id="account.report_invoice_document">

        <!-- Ajout du CSS -->
        <xpath expr="//div[@class='page']/div[1]" position="before">
            <link rel='stylesheet' href="/petit_reports/static/src/css/style.css"/>
        </xpath>

        <xpath expr="//p[@t-if='o.payment_term_id']" position="replace">
        </xpath>


        <!-- Informations principales -->
        <xpath expr="//div[@class='page']/div[2]" position="replace">
            <br />
            <div name="info">
                <div class="row">
                    <div t-if="o.name" class="col-xs-2">
                        <strong>Votre commande</strong>
                        <p t-field="o.name"/>
                    </div>
                    <div t-if="o.origin" class="col-xs-2">
                        <strong>Origine</strong>
                        <p t-field="o.origin"/>
                    </div>
                    <div t-if="o.date_invoice" class="col-xs-2">
                        <strong>Date</strong>
                        <p t-field="o.date_invoice" t-options='{"widget": "date"}'/>
                    </div>
                    <div t-if="o.date_due" class="col-xs-2">
                        <strong>Date d'échéance</strong>
                        <p t-field="o.date_due" t-options='{"widget": "date"}'/>
                    </div>
                    <div t-if="o.origin_id and o.origin_id.client_order_ref" class="col-xs-2">
                        <strong>Num commande</strong>
                        <p t-field="o.origin_id.client_order_ref"/>
                    </div>
                    <div t-if="o.partner_id and o.partner_id.vat" class="col-xs-2">
                        <strong>N° TVA client</strong>
                        <p t-field="o.partner_id.vat"/>
                    </div>
                    <!-- The number of columns is more than 12, so the last item will go on a new line if every items are displayed -->
                    <div t-if="o.payment_term_id and o.payment_term_id.name" class="col-xs-2">
                        <strong>Conditions de paiement</strong>
                        <p t-field="o.payment_term_id.name"/>
                    </div>
                </div>
            </div>
            <br />
            <!-- References client -->
            <t t-if="o.repair_order_id">
                <h4>Vos références</h4>
                <table class="table table_references">
                    <tr t-foreach="o.repair_order_id.get_references_fields()" t-as="line">
                        <t t-foreach="line" t-as="elem">
                            <td width="25%">
                                <strong><span t-esc="elem['name']"/></strong> <span t-esc="elem['value']"/>
                            </td>
                        </t>
                    </tr>
                </table>
            </t>
        </xpath>


        <!-- Ajout d'un tableau pour recapituler la TVA -->
        <xpath expr="//div[@class='page']/p[1]" position="before">
            <p t-field="o.invoicing_conditions"/>
        </xpath>


        <!-- Adresses -->
        <xpath expr="//div[@class='page']/div[1]" position="replace">
            <div class="row">
                <!-- Contact -->
                <div name="invoice_address" class="col-xs-4">
                    <strong>Contact commercial</strong>
                    <address t-field="o.user_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;name&quot;, &quot;email&quot;], &quot;no_marker&quot;: True}"/>
                    <strong>Contact comptable</strong>
                    <address t-field="o.create_uid" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;name&quot;, &quot;email&quot;], &quot;no_marker&quot;: True}"/>
                </div>
                <!-- Client -->
                <h4 class="col-xs-offset-2 col-xs-6">
                    <br/>
                    <div t-if="o.partner_id">
                        <span t-field="o.partner_id.name"/>
                    </div>
                    <div t-if="o.partner_id" t-field="o.partner_id" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;], &quot;no_marker&quot;: True}"/>
                </h4>
            </div>
        </xpath>

    </template>



    <!-- Creation d'un template pour les factures sans en-tete -->
    <template id="report_account_invoice_no_header">
        <!-- Retrait de l'en-tete -->
        <div class="header"/>

        <t t-foreach="docs" t-as="o">
            <t t-call="web.html_container">
                <!-- Appel du template des factures -->
                <t t-call="account.report_invoice_document" t-lang="o.partner_id.lang"/>
            </t>
        </t>
    </template>

</odoo>